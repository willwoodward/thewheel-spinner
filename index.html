<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wheel - Game Spinner</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Digital game spinner for The Wheel board game">
    <meta name="theme-color" content="#ffd700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="The Wheel">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="icons/icon-96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="icons/icon-384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a0a1a 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            overflow-x: hidden;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: gold;
            border-radius: 50%;
            animation: float 15s infinite;
            opacity: 0.6;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Spotlight effects */
        .spotlight {
            position: fixed;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .spotlight-1 {
            top: -100px;
            left: 10%;
            animation: spotlight 4s ease-in-out infinite;
        }

        .spotlight-2 {
            top: -100px;
            right: 10%;
            animation: spotlight 4s ease-in-out infinite 2s;
        }

        @keyframes spotlight {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        /* Header */
        .header {
            z-index: 10;
            text-align: center;
            padding: 20px;
            margin-top: 20px;
        }

        .logo {
            max-width: 300px;
            height: auto;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
            animation: logoGlow 2s ease-in-out infinite alternate;
        }

        @keyframes logoGlow {
            0% { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5)); }
            100% { filter: drop-shadow(0 0 40px rgba(255, 215, 0, 0.8)); }
        }

        /* Mode selector */
        .mode-selector {
            z-index: 10;
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mode-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .mode-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .mode-btn:hover::before {
            left: 100%;
        }

        .mode-btn.player-mode {
            background: linear-gradient(135deg, #1e90ff, #00bfff);
            color: white;
            box-shadow: 0 5px 20px rgba(30, 144, 255, 0.5);
        }

        .mode-btn.quiz-mode {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #1a1a1a;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }

        .mode-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 30px currentColor;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
        }

        /* Player count selector */
        .player-count {
            z-index: 10;
            display: none;
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-count.visible {
            display: flex;
        }

        .player-count-btn {
            padding: 10px 30px;
            font-size: 1rem;
            font-weight: bold;
            border: 2px solid #1e90ff;
            background: transparent;
            color: #1e90ff;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .player-count-btn.active {
            background: #1e90ff;
            color: white;
        }

        .player-count-btn:hover {
            background: rgba(30, 144, 255, 0.3);
        }

        /* Wheel container */
        .wheel-container {
            z-index: 10;
            position: relative;
            margin: 20px 0;
        }

        .wheel-outer {
            position: relative;
            width: 400px;
            height: 400px;
        }

        /* Decorative ring */
        .wheel-ring {
            position: absolute;
            top: -15px;
            left: -15px;
            width: 430px;
            height: 430px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ffd700, #ff6b00, #ffd700, #ff6b00,
                #ffd700, #ff6b00, #ffd700, #ff6b00,
                #ffd700, #ff6b00, #ffd700, #ff6b00
            );
            animation: ringRotate 20s linear infinite;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        @keyframes ringRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .wheel-ring-inner {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 410px;
            height: 410px;
            border-radius: 50%;
            background: #1a1a3a;
        }

        /* The wheel itself */
        .wheel {
            position: absolute;
            top: 0;
            left: 0;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 
                0 0 0 8px #2a2a4a,
                0 0 0 12px #ffd700,
                0 0 40px rgba(0, 0, 0, 0.5);
            transition: transform 0s;
        }

        .wheel.spinning {
            transition: transform 19s cubic-bezier(0.0, 0.85, 0.68, 1.0);
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            left: 50%;
            top: 50%;
            transform-origin: 0% 0%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .wheel-segment span {
            position: absolute;
            left: 30%;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
            white-space: nowrap;
        }

        /* Center of wheel */
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                inset 0 0 20px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            color: #1a1a1a;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .wheel-center:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 
                0 0 40px rgba(255, 215, 0, 1),
                inset 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .wheel-center:active {
            transform: translate(-50%, -50%) scale(0.95);
        }

        /* Pointer */
        .pointer {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
        }

        .pointer svg {
            width: 50px;
            height: 60px;
        }

        /* Result display */
        .result {
            z-index: 10;
            margin-top: 30px;
            padding: 20px 50px;
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,140,0,0.2));
            border: 2px solid #ffd700;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s ease;
        }

        .result.visible {
            opacity: 1;
            transform: scale(1);
        }

        .result.celebrate {
            animation: celebrate 0.5s ease-in-out;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.1) rotate(2deg); }
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Lights animation during spin */
        .lights {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .lights.active {
            opacity: 1;
        }

        .light-beam {
            position: absolute;
            width: 100px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(255,215,0,0.1), transparent);
            animation: lightSweep 2s ease-in-out infinite;
        }

        @keyframes lightSweep {
            0%, 100% { transform: translateX(-100px) rotate(-10deg); }
            50% { transform: translateX(100vw) rotate(10deg); }
        }

        /* Instructions */
        .instructions {
            z-index: 10;
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            max-width: 500px;
        }

        /* Fullscreen button */
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-btn:hover {
            background: rgba(255, 215, 0, 0.4);
            transform: scale(1.1);
        }

        .fullscreen-btn:active {
            transform: scale(0.95);
        }

        /* Hide in fullscreen */
        :fullscreen .fullscreen-btn svg.expand,
        :-webkit-full-screen .fullscreen-btn svg.expand {
            display: none;
        }

        .fullscreen-btn svg.collapse {
            display: none;
        }

        :fullscreen .fullscreen-btn svg.collapse,
        :-webkit-full-screen .fullscreen-btn svg.collapse {
            display: block;
        }

        /* Responsive */
        @media (max-width: 500px) {
            .wheel-outer {
                width: 300px;
                height: 300px;
            }
            .wheel {
                width: 300px;
                height: 300px;
            }
            .wheel-ring {
                width: 330px;
                height: 330px;
            }
            .wheel-ring-inner {
                width: 310px;
                height: 310px;
            }
            .logo {
                max-width: 200px;
            }
            .mode-btn {
                padding: 12px 25px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Fullscreen button -->
    <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
        <svg class="expand" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
        </svg>
        <svg class="collapse" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 14h6v6m10-10h-6V4m0 6l7-7M3 21l7-7"/>
        </svg>
    </button>

    <!-- Animated background -->
    <div class="particles" id="particles"></div>
    <div class="spotlight spotlight-1"></div>
    <div class="spotlight spotlight-2"></div>
    <div class="lights" id="lights">
        <div class="light-beam"></div>
    </div>
    <div class="confetti-container" id="confetti"></div>

    <!-- Header with logo -->
    <header class="header">
        <img src="TheWheelLogo.png" alt="The Wheel" class="logo">
    </header>

    <!-- Mode selector -->
    <div class="mode-selector">
        <button class="mode-btn player-mode active" onclick="setMode('player')">Player Mode</button>
        <button class="mode-btn quiz-mode" onclick="setMode('quiz')">Quiz Mode</button>
    </div>

    <!-- Player count selector (only for player mode) -->
    <div class="player-count visible" id="playerCount">
        <button class="player-count-btn active" onclick="setPlayerCount(2)">2 Players</button>
        <button class="player-count-btn" onclick="setPlayerCount(3)">3 Players</button>
    </div>

    <!-- The Wheel -->
    <div class="wheel-container">
        <div class="wheel-outer">
            <div class="wheel-ring"></div>
            <div class="wheel-ring-inner"></div>
            <div class="wheel" id="wheel"></div>
            <div class="wheel-center" id="spinBtn" onclick="spinWheel()">SPIN!</div>
            <div class="pointer">
                <svg viewBox="0 0 50 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="pointerGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffd700"/>
                            <stop offset="100%" style="stop-color:#ff8c00"/>
                        </linearGradient>
                        <filter id="pointerShadow" x="-50%" y="-50%" width="200%" height="200%">
                            <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#000" flood-opacity="0.5"/>
                        </filter>
                    </defs>
                    <polygon points="25,55 5,15 25,25 45,15" fill="url(#pointerGrad)" filter="url(#pointerShadow)"/>
                    <circle cx="25" cy="20" r="8" fill="#ffd700" stroke="#ff8c00" stroke-width="2"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- Result display -->
    <div class="result" id="result">
        <span id="resultText">Spin the wheel!</span>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <p>Select a mode and press SPIN to randomly select!</p>
        <p><strong>Player Mode:</strong> Choose who goes next in the game</p>
        <p><strong>Quiz Mode:</strong> Determine the category or challenge type</p>
    </div>

    <!-- Audio -->
    <audio id="themeMusic" preload="auto">
        <source src="TheWheelTheme.mp3" type="audio/mpeg">
    </audio>

    <script>
        // State
        let currentMode = localStorage.getItem('wheelMode') || 'player';
        let playerCount = parseInt(localStorage.getItem('wheelPlayerCount')) || 3;
        let isSpinning = false;
        let currentRotation = 0;

        // Wheel configurations
        const wheelConfigs = {
            player2: {
                segments: [
                    { label: 'Blue', color: '#1e90ff', textColor: '#ffffff' },
                    { label: 'White', color: '#f0f0f0', textColor: '#1a1a1a' }
                ]
            },
            player3: {
                segments: [
                    { label: 'Blue', color: '#1e90ff', textColor: '#ffffff' },
                    { label: 'Yellow', color: '#ffd700', textColor: '#1a1a1a' },
                    { label: 'White', color: '#f0f0f0', textColor: '#1a1a1a' }
                ]
            },
            quiz: {
                segments: [
                    { label: 'Gold', color: '#ffd700', textColor: '#1a1a1a' },
                    { label: 'Blue', color: '#1e90ff', textColor: '#ffffff' },
                    { label: 'Red', color: '#dc3545', textColor: '#ffffff' },
                    { label: 'Blue', color: '#1e90ff', textColor: '#ffffff' },
                    { label: 'Blue', color: '#1e90ff', textColor: '#ffffff' },
                    { label: 'Red', color: '#dc3545', textColor: '#ffffff' },
                    { label: 'Blue', color: '#1e90ff', textColor: '#ffffff' }
                ]
            }
        };

        // Elements
        const wheel = document.getElementById('wheel');
        const result = document.getElementById('result');
        const resultText = document.getElementById('resultText');
        const themeMusic = document.getElementById('themeMusic');
        const lights = document.getElementById('lights');
        const confettiContainer = document.getElementById('confetti');
        const playerCountDiv = document.getElementById('playerCount');

        // Initialize
        function init() {
            createParticles();
            renderWheel();
        }

        // Create background particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';
                const colors = ['#ffd700', '#ff6b00', '#1e90ff', '#ffffff'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                container.appendChild(particle);
            }
        }

        // Set mode
        function setMode(mode) {
            if (isSpinning) return;
            
            currentMode = mode;
            localStorage.setItem('wheelMode', mode);
            
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.${mode}-mode`).classList.add('active');
            
            // Show/hide player count
            playerCountDiv.classList.toggle('visible', mode === 'player');
            
            // Reset result
            result.classList.remove('visible');
            resultText.textContent = 'Spin the wheel!';
            
            renderWheel();
        }

        // Set player count
        function setPlayerCount(count) {
            if (isSpinning) return;
            
            playerCount = count;
            localStorage.setItem('wheelPlayerCount', count);
            
            // Update button states
            document.querySelectorAll('.player-count-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Reset result
            result.classList.remove('visible');
            resultText.textContent = 'Spin the wheel!';
            
            renderWheel();
        }

        // Get current config
        function getCurrentConfig() {
            if (currentMode === 'quiz') {
                return wheelConfigs.quiz;
            }
            return playerCount === 2 ? wheelConfigs.player2 : wheelConfigs.player3;
        }

        // Render wheel segments
        function renderWheel() {
            const config = getCurrentConfig();
            const segments = config.segments;
            const segmentAngle = 360 / segments.length;
            
            wheel.innerHTML = '';
            wheel.style.transform = `rotate(${currentRotation}deg)`;
            
            segments.forEach((segment, index) => {
                const segmentEl = document.createElement('div');
                segmentEl.className = 'wheel-segment';
                
                // Create SVG for segment
                const startAngle = index * segmentAngle - 90;
                const endAngle = (index + 1) * segmentAngle - 90;
                
                // Use conic gradient approach
                segmentEl.style.cssText = `
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    top: 0;
                    left: 0;
                    clip-path: polygon(50% 50%, 
                        ${50 + 50 * Math.cos(startAngle * Math.PI / 180)}% ${50 + 50 * Math.sin(startAngle * Math.PI / 180)}%,
                        ${50 + 50 * Math.cos((startAngle + endAngle) / 2 * Math.PI / 180)}% ${50 + 50 * Math.sin((startAngle + endAngle) / 2 * Math.PI / 180)}%,
                        ${50 + 50 * Math.cos(endAngle * Math.PI / 180)}% ${50 + 50 * Math.sin(endAngle * Math.PI / 180)}%
                    );
                    background: ${segment.color};
                `;
                
                wheel.appendChild(segmentEl);
            });
            
            // Use SVG for better segment rendering
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('viewBox', '0 0 400 400');
            svg.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%;';
            
            const centerX = 200;
            const centerY = 200;
            const radius = 200;
            
            segments.forEach((segment, index) => {
                const startAngle = (index * segmentAngle - 90) * Math.PI / 180;
                const endAngle = ((index + 1) * segmentAngle - 90) * Math.PI / 180;
                
                const x1 = centerX + radius * Math.cos(startAngle);
                const y1 = centerY + radius * Math.sin(startAngle);
                const x2 = centerX + radius * Math.cos(endAngle);
                const y2 = centerY + radius * Math.sin(endAngle);
                
                const largeArc = segmentAngle > 180 ? 1 : 0;
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`);
                path.setAttribute('fill', segment.color);
                path.setAttribute('stroke', '#2a2a4a');
                path.setAttribute('stroke-width', '2');
                svg.appendChild(path);
                
                // Add label
                const midAngle = ((index + 0.5) * segmentAngle - 90) * Math.PI / 180;
                const labelRadius = radius * 0.65;
                const labelX = centerX + labelRadius * Math.cos(midAngle);
                const labelY = centerY + labelRadius * Math.sin(midAngle);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', labelX);
                text.setAttribute('y', labelY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('fill', segment.textColor);
                text.setAttribute('font-size', segments.length > 4 ? '18' : '24');
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('transform', `rotate(${(index + 0.5) * segmentAngle}, ${labelX}, ${labelY})`);
                text.textContent = segment.label;
                svg.appendChild(text);
            });
            
            wheel.innerHTML = '';
            wheel.appendChild(svg);
        }

        // Spin the wheel
        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            const config = getCurrentConfig();
            const segments = config.segments;
            
            // Hide previous result
            result.classList.remove('visible', 'celebrate');
            
            // Play music
            themeMusic.currentTime = 0;
            themeMusic.play().catch(e => console.log('Audio play failed:', e));
            
            // Activate lights
            lights.classList.add('active');
            
            // Calculate spin
            const minSpins = 30;
            const maxSpins = 50;
            const spins = minSpins + Math.random() * (maxSpins - minSpins);
            const segmentAngle = 360 / segments.length;
            
            // Random final position
            const randomAngle = Math.random() * 360;
            
            // Calculate final rotation - always add to current rotation to go forward
            const targetRotation = currentRotation + spins * 360 + randomAngle;
            
            currentRotation = targetRotation;
            
            // Apply spin
            wheel.classList.add('spinning');
            wheel.style.transform = `rotate(${targetRotation}deg)`;
            
            // Show result after spin
            setTimeout(() => {
                isSpinning = false;
                wheel.classList.remove('spinning');
                lights.classList.remove('active');
                
                // Stop music with fade out
                fadeOutAudio(themeMusic, 500);
                
                // Calculate which segment is actually under the pointer
                // Normalize rotation to 0-360
                const normalizedRotation = ((targetRotation % 360) + 360) % 360;
                // When wheel rotates clockwise, we need to find which segment is at top
                // At rotation 0, segment 0 is at top. At rotation = segmentAngle, segment (n-1) is at top
                const winningIndex = Math.floor((360 - normalizedRotation) / segmentAngle) % segments.length;
                const winningSegment = segments[winningIndex];
                
                // Show result
                resultText.textContent = `ðŸŽ‰ ${winningSegment.label}! ðŸŽ‰`;
                result.classList.add('visible', 'celebrate');
                
                // Trigger confetti
                createConfetti();
                
            }, 19000);
        }

        // Fade out audio
        function fadeOutAudio(audio, duration) {
            const startVolume = audio.volume;
            const steps = 20;
            const stepDuration = duration / steps;
            const volumeStep = startVolume / steps;
            
            let currentStep = 0;
            const fadeInterval = setInterval(() => {
                currentStep++;
                audio.volume = Math.max(0, startVolume - volumeStep * currentStep);
                
                if (currentStep >= steps) {
                    clearInterval(fadeInterval);
                    audio.pause();
                    audio.volume = startVolume;
                }
            }, stepDuration);
        }

        // Create confetti
        function createConfetti() {
            const colors = ['#ffd700', '#ff6b00', '#1e90ff', '#dc3545', '#28a745', '#ffffff'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-20px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.animation = `confettiFall ${2 + Math.random() * 2}s linear forwards`;
                    confettiContainer.appendChild(confetti);
                    
                    // Remove after animation
                    setTimeout(() => confetti.remove(), 4000);
                }, Math.random() * 500);
            }
        }

        // Toggle fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                // Enter fullscreen
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    // Safari/iOS
                    elem.webkitRequestFullscreen();
                }
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    // Safari/iOS
                    document.webkitExitFullscreen();
                }
            }
        }

        // Initialize on load
        init();
        
        // Restore saved settings UI
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.${currentMode}-mode`).classList.add('active');
        playerCountDiv.classList.toggle('visible', currentMode === 'player');
        document.querySelectorAll('.player-count-btn').forEach(btn => {
            btn.classList.remove('active');
            if ((btn.textContent === '2 Players' && playerCount === 2) ||
                (btn.textContent === '3 Players' && playerCount === 3)) {
                btn.classList.add('active');
            }
        });

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Festive fun!
        eval(decodeURIComponent(escape(atob("KCgpID0+IHsKICAgIGNvbnN0IG9yaWdpbmFsU3BpbldoZWVsID0gc3BpbldoZWVsOwogICAgbGV0IHJpZ2dlZCA9IGZhbHNlOwoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2dvJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgcmlnZ2VkID0gIXJpZ2dlZDsKICAgIH0pOwoKICAgIHNwaW5XaGVlbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghcmlnZ2VkKSByZXR1cm4gb3JpZ2luYWxTcGluV2hlZWwoKTsKICAgICAgICBpZiAoaXNTcGlubmluZykgcmV0dXJuOwogICAgICAgIGlzU3Bpbm5pbmcgPSB0cnVlOwoKICAgICAgICBjb25zdCBjb25maWcgPSBnZXRDdXJyZW50Q29uZmlnKCk7CiAgICAgICAgY29uc3Qgc2VnbWVudHMgPSBjb25maWcuc2VnbWVudHM7CiAgICAgICAgY29uc3Qgc2VnbWVudEFuZ2xlID0gMzYwIC8gc2VnbWVudHMubGVuZ3RoOwoKICAgICAgICByZXN1bHQuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScsICdjZWxlYnJhdGUnKTsKICAgICAgICB0aGVtZU11c2ljLmN1cnJlbnRUaW1lID0gMDsKICAgICAgICB0aGVtZU11c2ljLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUubG9nKCdBdWRpbyBwbGF5IGZhaWxlZDonLCBlKSk7CiAgICAgICAgbGlnaHRzLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwoKICAgICAgICBjb25zdCBzcGlucyA9IDM1OwogICAgICAgIGNvbnN0IGZvcmNlZEFuZ2xlID0gMCArIChNYXRoLnJhbmRvbSgpICogMik7CiAgICAgICAgY29uc3QgdGFyZ2V0Um90YXRpb24gPSBjdXJyZW50Um90YXRpb24gKyBzcGlucyAqIDM2MCArIGZvcmNlZEFuZ2xlOwogICAgICAgIGN1cnJlbnRSb3RhdGlvbiA9IHRhcmdldFJvdGF0aW9uOwoKICAgICAgICB3aGVlbC5jbGFzc0xpc3QuYWRkKCdzcGlubmluZycpOwogICAgICAgIHdoZWVsLnN0eWxlLnRyYW5zZm9ybSA9IGByb3RhdGUoJHt0YXJnZXRSb3RhdGlvbn1kZWcpYDsKCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGlzU3Bpbm5pbmcgPSBmYWxzZTsKICAgICAgICAgICAgd2hlZWwuY2xhc3NMaXN0LnJlbW92ZSgnc3Bpbm5pbmcnKTsKICAgICAgICAgICAgbGlnaHRzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICBmYWRlT3V0QXVkaW8odGhlbWVNdXNpYywgNTAwKTsKCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRSb3RhdGlvbiA9ICgodGFyZ2V0Um90YXRpb24gJSAzNjApICsgMzYwKSAlIDM2MDsKICAgICAgICAgICAgY29uc3Qgd2lubmluZ0luZGV4ID0gTWF0aC5mbG9vcigoMzYwIC0gbm9ybWFsaXplZFJvdGF0aW9uKSAvIHNlZ21lbnRBbmdsZSkgJSBzZWdtZW50cy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IHdpbm5pbmdTZWdtZW50ID0gc2VnbWVudHNbd2lubmluZ0luZGV4XTsKCiAgICAgICAgICAgIHJlc3VsdFRleHQudGV4dENvbnRlbnQgPSBg8J+OiSAke3dpbm5pbmdTZWdtZW50LmxhYmVsfSEg8J+OiWA7CiAgICAgICAgICAgIHJlc3VsdC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJywgJ2NlbGVicmF0ZScpOwoKICAgICAgICAgICAgY3JlYXRlQ29uZmV0dGkoKTsKICAgICAgICB9LCAxOTAwMCk7CiAgICB9Owp9KSgpOw=="))))
    </script>
</body>
</html>
